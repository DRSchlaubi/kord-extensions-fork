
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="canonical" href="https://kord-extensions.docs.kotlindiscord.com/integrations/sentry/">
      
      <link rel="shortcut icon" href="../../assets/icon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.2">
    
    
      
        <title>Sentry - Kord Extensions</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.73f7c429.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.39b8e14a.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="" data-md-color-accent="">
      
        <script>matchMedia("(prefers-color-scheme: dark)").matches&&document.body.setAttribute("data-md-color-scheme","slate")</script>
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#sentry" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://kord-extensions.docs.kotlindiscord.com" title="Kord Extensions" class="md-header-nav__button md-logo" aria-label="Kord Extensions">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            Kord Extensions
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              Sentry
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://kord-extensions.docs.kotlindiscord.com" title="Kord Extensions" class="md-nav__button md-logo" aria-label="Kord Extensions">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    Kord Extensions
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      



  <li class="md-nav__item">
    <a href="../.." class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="../../getting-started/" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" >
    
    <label class="md-nav__link" for="nav-3">
      Concepts
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Concepts" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        Concepts
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../concepts/bot/" class="md-nav__link">
      The Bot Object
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../concepts/extensions/" class="md-nav__link">
      Extensions
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../concepts/events/" class="md-nav__link">
      Events
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../concepts/checks/" class="md-nav__link">
      Checks
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../concepts/commands/" class="md-nav__link">
      Commands
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../concepts/converters/" class="md-nav__link">
      Converters
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" >
    
    <label class="md-nav__link" for="nav-4">
      Utilities
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Utilities" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        Utilities
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../utilities/general/" class="md-nav__link">
      General
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../utilities/paginator/" class="md-nav__link">
      Paginator
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  


  
  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Integrations
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Integrations" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        Integrations
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Sentry
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Sentry
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setting-up" class="md-nav__link">
    Setting up
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-context-to-errors" class="md-nav__link">
    Adding context to errors
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#collecting-user-feedback" class="md-nav__link">
    Collecting user feedback
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manual-usage" class="md-nav__link">
    Manual usage
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="/-kord%20-extensions/" class="md-nav__link">
      Dokka API Docs
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setting-up" class="md-nav__link">
    Setting up
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-context-to-errors" class="md-nav__link">
    Adding context to errors
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#collecting-user-feedback" class="md-nav__link">
    Collecting user feedback
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manual-usage" class="md-nav__link">
    Manual usage
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="sentry">Sentry</h1>
<p><a href="https://sentry.io/">Sentry</a> is a web-based tool used for keeping track of errors in your applications. Kord Extensions
provides a first-party build-in integration for anyone that uses Sentry to keep track of errors in their production
bots, with full support for breadcrumbs in your commands and event handlers so you can tell Sentry exactly what
went wrong.</p>
<details class="tip"><summary>Discord webhooks?</summary><p>Sentry does not support Discord webhooks out of the box - however, Discord does support Slack-format webhooks. As
Slack requires current integrations to use OAuth, Sentry has hidden their legacy integration - but it can still be
used. To find it, head to the settings for your project and append <code>/plugins/slack/</code> to the URL - for example,
<code>https://sentry.io/settings/my-org/projects/bot/plugins/slack/</code>. The webhook URL should also have <code>/slack</code> appended,
so it looks like this: <code>https://discordapp.com/api/webhooks/{ID}/{TOKEN}/slack</code></p>
</details>
<h2 id="setting-up">Setting up</h2>
<p>Kord Extensions ships with the Sentry library by default, but no logging integration - we recommend matching the
version of your logging integration with the Sentry library shipped with Kord, but of course you can treat it just
like any other transitive dependency.</p>
<p>The <code>ExtensibleBot</code> object contains a <code>sentry</code> property referring to a <code>SentryAdapter</code> instance - to enable the
Sentry integration, you'll need to set this object up using its <code>init</code> function. For example:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">val</span> <span class="py">bot</span> <span class="p">=</span> <span class="n">ExtensibleBot</span><span class="p">(</span><span class="s">&quot;!&quot;</span><span class="p">,</span> <span class="n">TOKEN</span><span class="p">)</span>

<span class="k">if</span> <span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">getenv</span><span class="p">().</span><span class="n">getOrDefault</span><span class="p">(</span><span class="s">&quot;SENTRY_DSN&quot;</span><span class="p">,</span> <span class="k">null</span><span class="p">)</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">bot</span><span class="p">.</span><span class="n">sentry</span><span class="p">.</span><span class="n">init</span> <span class="p">{</span>
        <span class="n">dsn</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">&quot;SENTRY_DSN&quot;</span><span class="p">)</span>
        <span class="n">environment</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">getenv</span><span class="p">().</span><span class="n">getOrDefault</span><span class="p">(</span><span class="s">&quot;ENVIRONMENT&quot;</span><span class="p">,</span> <span class="s">&quot;production&quot;</span><span class="p">)</span>
        <span class="n">release</span> <span class="p">=</span> <span class="s">&quot;...&quot;</span>  <span class="c1">// However you get your Sentry release info</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>There's an alternative version of the <code>init</code> function that you can pass parameters to instead, but we highly recommend
the use of the lambda-based function since it directly maps to Sentry's own <code>init</code> method.</p>
<h2 id="adding-context-to-errors">Adding context to errors</h2>
<p>Sentry's main method of collecting error context is to add breadcrumbs. Breadcrumbs essentially record the steps that
were taken to reach your problem, including extra data that can provide additional context.</p>
<p>Commands and event handlers both have built-in Sentry reporting, and include a mechanism for keeping track of
breadcrumbs that you add as your command or event is processing. You can do this in one of two ways:</p>
<ol>
<li>Use the <code>breadcrumb</code> function on the <code>CommandContext</code> or <code>EventContext</code> object to add a breadcrumb</li>
<li>Use the <code>breadcrumbs</code> mutable list on the <code>CommandContext</code> or <code>EventContext</code> object, and use the
   <code>bot.sentry.createBreadcrumb</code> function to create breadcrumbs to add to it - this is particularly useful if you need
   to pass the list around to different functions to collect breadcrumbs from them</li>
</ol>
<p>When an error occurs, the bot will create a Sentry scope configured with information about the command or event that
caused the error, and it'll create an initial breadcrumb corresponding to the start of processing. It'll then take
all the breadcrumbs you created, add them to the scope, and submit the scope directly to Sentry.</p>
<p>There's nothing more that you need to do - you'll see the issue appear in Sentry with all of its breadcrumbs and
associated context!</p>
<figure>
    <a href="/assets/sentry-breadcrumbs.png">
        <img src="/assets/sentry-breadcrumbs.png" width="100%" alt="Sentry breadcrumbs" /> 
    </a>
    <a href="/assets/sentry-data.png">
        <img src="/assets/sentry-data.png" width="100%" alt="Sentry data" /> 
    </a>
</figure>

<p>For a list of supported breadcrumb types, please see
<a href="https://develop.sentry.dev/sdk/event-payloads/breadcrumbs/#breadcrumb-types">the Sentry documentation</a>.</p>
<h2 id="collecting-user-feedback">Collecting user feedback</h2>
<p>If an error occurs during command processing, and you have the Sentry extension enabled (which it is by default),
the returned error message will contain a Sentry ID and information on how to submit a piece of user feedback. This
includes a <code>feedback</code> command, which will be automatically registered by the Sentry extension.</p>
<p>If you wish to disable this, pass <code>false</code> for the <code>addSentryExtension</code> constructor param for your <code>ExtensibleBot</code>
instance, and both the Sentry ID in the error and the <code>feedback</code> command will be disabled.</p>
<p><a href="/assets/sentry-feedback.png">
    <figure>
        <img src="/assets/sentry-feedback.png" width="100%" alt="Sentry feedback" /> 
    </figure>
</a></p>
<h2 id="manual-usage">Manual usage</h2>
<p>You can, of course, make use of Sentry <a href="https://docs.sentry.io/platforms/java/">as per its documentation</a>. However,
bear in mind that both Kord and Kord Extensions are coroutine-based, and that means that a lot of the things you do
will be asynchronous.</p>
<p>Because of this, you'll want to collect breadcrumbs and other context yourself instead of creating a scope early -
the best way of doing this is with a simple list of <code>Breadcrumb</code> objects. When an error happens, you can create the
Sentry scope, add the breadcrumbs and other context, and submit it all at once. Failure to do this will result in
issues, as Sentry uses a simple stack that it pushes and pops scopes onto without regard for any context - so you
may end up adding breadcrumbs to the wrong scope, or submitting a scope from another part of the application too
early if you don't watch out for this!</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../../utilities/paginator/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Paginator
              </div>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.08c56446.min.js"></script>
      <script src="../../assets/javascripts/bundle.6ced434e.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.8c7e0a7e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>